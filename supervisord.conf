# Example supervisord.conf for django-agent-runtime
#
# This configuration runs two processes:
# 1. daphne - ASGI web server (handles HTTP requests, WebSockets, SSE)
# 2. runagent - Agent worker process (processes agent tasks from the queue)
#
# Both processes are required for a fully functional agent runtime.

[supervisord]
nodaemon=true
logfile=/dev/stdout
logfile_maxbytes=0
loglevel=info

# Web server - Daphne (ASGI)
# Replace 'myproject.asgi:application' with your project's ASGI application
[program:daphne]
command=daphne --proxy-headers -b 0.0.0.0 -p %(ENV_PORT)s myproject.asgi:application
directory=/app
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=10

# Agent worker - processes agent tasks
# The --noreload flag is important for production
[program:runagent]
command=python manage.py runagent --noreload
directory=/app
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=20
# Give daphne a moment to start first
startsecs=5
